<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PO System â€” Single Page + Export Excel</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    body{font-family:Arial;background:#f7f7f7;padding:20px}
    .box{background:#fff;padding:20px;border-radius:10px;max-width:900px;margin:auto;box-shadow:0 4px 12px rgba(0,0,0,0.08)}
    label{display:block;margin-top:10px;font-size:14px}
    input,select{padding:8px;width:100%;margin-top:4px;border:1px solid #ccc;border-radius:6px}
    table{width:100%;border-collapse:collapse;margin-top:15px}
    th,td{border:1px solid #ddd;padding:8px;font-size:14px}
    .btn{padding:8px 12px;border:none;border-radius:6px;background:#2563eb;color:#fff;cursor:pointer;margin-top:10px}
    .btn.red{background:#dc2626}
  </style>
</head>
<body>
<div class="box">
  <h2>ðŸ“„ Form Purchase Order</h2>

  <h3>1) Informasi Perusahaan</h3>
  <label>Perusahaan <input id="company_name"></label>
  <label>Alamat <input id="company_address"></label>
  <label>Fax <input id="company_fax"></label>
  <label>Melalui <input id="company_via"></label>
  <label>Kontak Person <input id="company_contact"></label>

  <h3>2) Item PO</h3>
  <label>Pilih Nama Alat
    <select id="tool_select"></select>
  </label>
  <label>Qty <input id="qty" type="number" min="1" value="1"></label>
  <label>Tarif (editable) <input id="price" type="number" min="0" value="0"></label>
  <button class="btn" id="add_item">Tambah Item</button>

  <table id="items_table">
    <thead>
      <tr>
        <th>Nama Alat</th><th>Lokasi</th><th>Akreditasi</th><th>Kemampuan</th><th>Qty</th><th>Tarif</th><th>Total</th><th>Aksi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3>Total: <span id="po_total">0</span></h3>

  <button class="btn" id="export_excel">ðŸ“¥ Download Excel</button>
</div>

<script>
// SAMPLE DATA â€” ganti dengan data Anda atau file data.json
const SAMPLE_DATA = [
  {"id":"A1","nama":"Alat Kalibrasi A","tarif":150000,"lokasi":"Lab A","status_akreditasi":"SNI","kemampuan":"0.01 - 100"},
  {"id":"A2","nama":"Alat Uji B","tarif":200000,"lokasi":"Lab B","status_akreditasi":"ISO","kemampuan":"0.1 - 50"}
];

let tools = SAMPLE_DATA;
let items = [];

function loadTools(){
  const sel = document.getElementById('tool_select');
  sel.innerHTML = '';
  tools.forEach(t=>{
    const o = document.createElement('option');
    o.value = t.id;
    o.textContent = `${t.nama} â€” Rp ${t.tarif.toLocaleString('id-ID')}`;
    o.dataset.tarif = t.tarif;
    sel.appendChild(o);
  });
  document.getElementById('price').value = tools[0].tarif;
}

loadTools();

document.getElementById('tool_select').addEventListener('change', e=>{
  const opt = e.target.options[e.target.selectedIndex];
  document.getElementById('price').value = opt.dataset.tarif;
});

document.getElementById('add_item').addEventListener('click', ()=>{
  const id = document.getElementById('tool_select').value;
  const tool = tools.find(t=>t.id==id);
  const qty = parseFloat(document.getElementById('qty').value) || 1;
  const price = parseFloat(document.getElementById('price').value) || tool.tarif;

  items.push({nama:tool.nama,lokasi:tool.lokasi,akreditasi:tool.status_akreditasi,kemampuan:tool.kemampuan,qty,price});
  renderItems();
});

function renderItems(){
  const tbody = document.querySelector('#items_table tbody');
  tbody.innerHTML = '';
  let total = 0;

  items.forEach((it,idx)=>{
    const row = document.createElement('tr');
    const subtotal = it.qty * it.price;
    total += subtotal;

    row.innerHTML = `
      <td>${it.nama}</td>
      <td>${it.lokasi}</td>
      <td>${it.akreditasi}</td>
      <td>${it.kemampuan}</td>
      <td>${it.qty}</td>
      <td>${it.price}</td>
      <td>${subtotal}</td>
      <td><button class='btn red' onclick='removeItem(${idx})'>Hapus</button></td>
    `;

    tbody.appendChild(row);
  });

  document.getElementById('po_total').textContent = total.toLocaleString('id-ID');
}

function removeItem(i){ items.splice(i,1); renderItems(); }

// EXPORT KE EXCEL
document.getElementById('export_excel').addEventListener('click', ()=>{
  const data = [];

  data.push({"FIELD":"Perusahaan", "VALUE":document.getElementById('company_name').value});
  data.push({"FIELD":"Alamat", "VALUE":document.getElementById('company_address').value});
  data.push({"FIELD":"Fax", "VALUE":document.getElementById('company_fax').value});
  data.push({"FIELD":"Melalui", "VALUE":document.getElementById('company_via').value});
  data.push({"FIELD":"Kontak Person", "VALUE":document.getElementById('company_contact').value});
  data.push({});
  data.push({"FIELD":"Items PO", "VALUE":""});

  items.forEach(it=>{
    data.push({
      "FIELD":`${it.nama} (Qty ${it.qty})`,
      "VALUE":`Tarif ${it.price} â€” Total ${it.qty*it.price}`
    });
  });

  const ws = XLSX.utils.json_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "PO");
  XLSX.writeFile(wb, "PO.xlsx");
});
</script>
</body>
</html>
