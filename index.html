<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<title>PO System</title>
<style>
  body { font-family: Arial; margin:20px; }
  input, select { padding:6px; width:100%; margin:4px 0; }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  th, td { border:1px solid #ccc; padding:6px; }
  button { padding:8px 14px; margin:8px 0; }
  .section { border:1px solid #ddd; padding:15px; margin-bottom:20px; border-radius:8px; }
</style>
</head>
<body>

<h2>ðŸ“„ PURCHASE ORDER SYSTEM</h2>

<!-- ========================================= -->
<!-- ========== 1. INFORMASI PERUSAHAAN ======= -->
<!-- ========================================= -->
<div class="section">
  <h3>1. Informasi Perusahaan</h3>
  <label>Perusahaan</label><input id="perusahaan">
  <label>Alamat</label><input id="alamat">
  <label>Fax</label><input id="fax">
  <label>Melalui</label><input id="melalui">
  <label>Kontak Person</label><input id="kontak">
</div>

<!-- ========================================= -->
<!-- ========== DATA JSON ALAT KALIBRASI ===== -->
<!-- ========================================= -->
<script>
const alatData = [
  {
    nama: "Multimeter Digital",
    lokasi: "Lab Kalibrasi A",
    akreditasi: "ISO 17025",
    kemampuan: "0 - 1000V",
    tarif: 150000
  },
  {
    nama: "Sound Level Meter",
    lokasi: "Lab Akustik",
    akreditasi: "KAN",
    kemampuan: "30 - 130 dB",
    tarif: 200000
  }
];

// Format ke Rupiah
function toRupiah(num) {
  return "Rp " + num.toLocaleString("id-ID");
}

// Convert "Rp 150.000" â†’ 150000 (angka)
function fromRupiah(str) {
  return parseInt(str.replace(/[^0-9]/g, "")) || 0;
}
</script>

<!-- ========================================= -->
<!-- === 2. ITEM PO (ALAT YANG DIKALIBRASI) === -->
<!-- ========================================= -->
<div class="section">
  <h3>2. Item PO (Alat yang Dikalibrasi)</h3>

  <button onclick="tambahBarisKalibrasi()">Tambah Item</button>

  <table id="tabelKalibrasi">
    <tr>
      <th>Nama Alat</th>
      <th>No Seri</th>
      <th>Qty</th>
      <th>Total Jam</th>
      <th>Harga</th>
      <th>Total</th>
      <th>Aksi</th>
    </tr>
  </table>
</div>

<!-- ========================================= -->
<!-- ====== 3. ALAT TIDAK DAPAT DIKALIBRASI === -->
<!-- ========================================= -->
<div class="section">
  <h3>3. Alat Tidak Dapat Dikalibrasi</h3>
  <button onclick="tambahBarisNonKalibrasi()">Tambah Item</button>

  <table id="tabelNonKalibrasi">
    <tr>
      <th>Nama Alat</th>
      <th>No Seri</th>
      <th>Qty</th>
      <th>Keterangan</th>
      <th>Aksi</th>
    </tr>
  </table>
</div>

<!-- ========================================= -->
<!-- ========= 4. BIAYA JASA KALIBRATOR ======= -->
<!-- ========================================= -->
<div class="section">
  <h3>4. Biaya Jasa Kalibrator</h3>
  <button onclick="tambahBarisKalibrator()">Tambah Baris</button>

  <table id="tabelKalibrator">
    <tr>
      <th>Jumlah Orang</th>
      <th>Biaya per Orang</th>
      <th>Total</th>
      <th>Aksi</th>
    </tr>
  </table>
</div>

<script>
/* ================================================================
   ========== 2. TAMBAH ITEM KALIBRASI + DROPDOWN JSON ============
   ================================================================ */
function tambahBarisKalibrasi() {
  let table = document.getElementById("tabelKalibrasi");
  let row = table.insertRow();

  let dropdown =
    `<select onchange='isiOtomatis(this)'>
      <option value=''>-- pilih alat --</option>
      ${alatData.map((a, i) => `<option value='${i}'>${a.nama}</option>`).join("")}
    </select>`;

  row.innerHTML = `
    <td>${dropdown}</td>
    <td contenteditable='true'></td>
    <td class='qty' contenteditable='true'>1</td>
    <td class='jam' contenteditable='true'>0</td>
    <td class='harga' contenteditable='true'>${toRupiah(0)}</td>
    <td class='total' contenteditable='false'>${toRupiah(0)}</td>
    <td><button onclick='hapus(this)'>Hapus</button></td>
  `;

  // Event input agar qty / harga berubah â†’ total update
  row.addEventListener("input", () => {
    hitungTotalKalibrasi();
  });
}

// isi otomatis dari JSON
function isiOtomatis(sel) {
  if (sel.value === "") return;

  let data = alatData[sel.value];
  let tr = sel.parentElement.parentElement;

  tr.cells[1].innerText = "-";
  tr.cells[3].innerText = data.kemampuan;
  tr.cells[4].innerText = toRupiah(data.tarif);

  hitungTotalKalibrasi();
}

// Hitung total otomatis + auto format Rupiah
function hitungTotalKalibrasi() {
  document.querySelectorAll("#tabelKalibrasi tr").forEach((tr, idx) => {
    if (idx === 0) return;

    let qty = parseFloat(tr.querySelector(".qty").innerText) || 0;
    let harga = fromRupiah(tr.querySelector(".harga").innerText);

    let total = qty * harga;
    tr.querySelector(".total").innerText = toRupiah(total);
  });
}

/* ================================================================
   =============== 3. TAMBAH BARIS NON-KALIBRASI ===================
   ================================================================ */
function tambahBarisNonKalibrasi() {
  let table = document.getElementById("tabelNonKalibrasi");
  let row = table.insertRow();

  row.innerHTML = `
    <td contenteditable='true'></td>
    <td contenteditable='true'></td>
    <td contenteditable='true'>1</td>
    <td contenteditable='true'></td>
    <td><button onclick='hapus(this)'>Hapus</button></td>
  `;
}

/* ================================================================
   ============= 4. BIAYA JASA KALIBRATOR + RUPIAH ================
   ================================================================ */
function tambahBarisKalibrator() {
  let table = document.getElementById("tabelKalibrator");
  let row = table.insertRow();

  row.innerHTML = `
    <td contenteditable='true'>1</td>
    <td class='biaya' contenteditable='true'>${toRupiah(0)}</td>
    <td class='total' contenteditable='false'>${toRupiah(0)}</td>
    <td><button onclick='hapus(this)'>Hapus</button></td>
  `;

  row.addEventListener("input", () => {
    let qty = parseFloat(row.cells[0].innerText) || 0;
