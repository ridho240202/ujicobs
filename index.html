<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>PO System Sederhana</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <style>
    body { font-family: Arial; margin: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ccc; padding: 6px; }
    select, input { width: 100%; padding: 4px; }
    button { padding: 8px 12px; margin-top: 10px; }
  </style>
</head>
<body>

<h2>ðŸ“„ PURCHASE ORDER SYSTEM</h2>

<!-- ===================== INFORMASI PERUSAHAAN ===================== -->
<h3>1. Informasi Perusahaan</h3>
<label>Perusahaan</label>
<input id="perusahaan">

<label>Alamat</label>
<input id="alamat">

<label>Fax</label>
<input id="fax">

<label>Melalui</label>
<input id="melalui">

<label>Kontak Person</label>
<input id="kontak">

<hr>

<!-- ===================== DATA ALAT JSON ===================== -->
<script>
const alatData = [
  {
    nama: "Multimeter Digital",
    lokasi: "Lab Kalibrasi A",
    akreditasi: "ISO 17025",
    kemampuan: "0 - 1000V",
    tarif: 150000
  },
  {
    nama: "Sound Level Meter",
    lokasi: "Lab Akustik",
    akreditasi: "KAN",
    kemampuan: "30 - 130 dB",
    tarif: 200000
  }
];
</script>

<!-- ===================== TABEL PO ===================== -->
<h3>2. Item PO</h3>

<button onclick="tambahRow()">+ Tambah Item</button>

<table id="poTable">
  <thead>
    <tr>
      <th>Nama Alat</th>
      <th>Lokasi</th>
      <th>Akreditasi</th>
      <th>Kemampuan</th>
      <th>Qty</th>
      <th>Tarif</th>
      <th>Total</th>
      <th>Aksi</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<button onclick="downloadExcel()">ðŸ“¥ Download Excel</button>

<script>
// Tambah baris kosong dengan dropdown
function tambahRow() {
  let tbody = document.querySelector("#poTable tbody");
  let row = document.createElement("tr");

  row.innerHTML = `
    <td>
      <select onchange="isiData(this)">
        <option value="">-- pilih alat --</option>
        ${alatData.map((a,i)=>`<option value="${i}">${a.nama}</option>`).join("")}
      </select>
    </td>
    <td class="lokasi"></td>
    <td class="akreditasi"></td>
    <td class="kemampuan"></td>
    <td><input type="number" value="1" min="1" onchange="updateTotal(this)"></td>
    <td class="tarif"></td>
    <td class="total"></td>
    <td><button onclick="hapusRow(this)">Hapus</button></td>
  `;

  tbody.appendChild(row);
}

// Ketika memilih alat â†’ otomatis isi detail
function isiData(selectEl) {
  let idx = selectEl.value;
  let row = selectEl.parentElement.parentElement;

  if (idx === "") return;

  let alat = alatData[idx];

  row.querySelector(".lokasi").innerText = alat.lokasi;
  row.querySelector(".akreditasi").innerText = alat.akreditasi;
  row.querySelector(".kemampuan").innerText = alat.kemampuan;
  row.querySelector(".tarif").innerText = alat.tarif;

  updateTotal(selectEl);
}

// Update total ketika qty berubah
function updateTotal(el) {
  let row = el.parentElement.parentElement;
  let qty = row.querySelector("input").value;
  let tarif = row.querySelector(".tarif").innerText;

  let total = qty * tarif;
  row.querySelector(".total").innerText = total;
}

// Hapus baris
function hapusRow(btn) {
  btn.parentElement.parentElement.remove();
}

// Download Excel
function downloadExcel() {
  let perusahaan = document.getElementById("perusahaan").value;
  let alamat = document.getElementById("alamat").value;
  let fax = document.getElementById("fax").value;
  let melalui = document.getElementById("melalui").value;
  let kontak = document.getElementById("kontak").value;

  let rows = [["Nama Alat", "Lokasi", "Akreditasi", "Kemampuan", "Qty", "Tarif", "Total"]];

  document.querySelectorAll("#poTable tbody tr").forEach(tr => {
    let nama = tr.querySelector("select").selectedOptions[0].text;
    let lokasi = tr.querySelector(".lokasi").innerText;
    let ak = tr.querySelector(".akreditasi").innerText;
    let kemampuan = tr.querySelector(".kemampuan").innerText;
    let qty = tr.querySelector("input").value;
    let tarif = tr.querySelector(".tarif").innerText;
    let total = tr.querySelector(".total").innerText;

    rows.push([nama, lokasi, ak, kemampuan, qty, tarif, total]);
  });

  // Sheet perusahaan
  let sheet1 = [
    ["Perusahaan", perusahaan],
    ["Alamat", alamat],
    ["Fax", fax],
    ["Melalui", melalui],
    ["Kontak", kontak]
  ];

  let wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(sheet1), "Perusahaan");
  XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(rows), "Item PO");

  XLSX.writeFile(wb, "PO.xlsx");
}
</script>

</body>
</html>
